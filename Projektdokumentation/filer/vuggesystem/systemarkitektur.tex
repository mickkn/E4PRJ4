\section{Systemarkitektur}

I dette afsnit beskrives systemarkitekturen for vuggesystemet.

\subsection*{Overordnet virkemåde}
Vuggesystemet fungerer overordnet som følger:
\begin{itemize}
	\item Vuggesystemets Regulerings MCU står for at vugge barnevognens kurv med en bestemt vuggefrekvens og et bestemt vinkeludsving. Dette sker på baggrund af værdier for disse modtaget fra Controller
	\item Regulerings MCU'en regulerer vuggesystemet således at vugningen altid foregår ud fra en vandret akse samt at de modtagne værdier for vuggefrekvensen og vinkeludsvinget overholdes  
	\item Kommunikation mellem Regulerings MCU og Controlleren foregår via I2C protokollen
\end{itemize}

\subsection{Hardware arkitektur}

\figur{1}{vuggesystem/sysark/Vuggesystem_BDD.pdf}{BDD for Vuggesystem}{Vug_BDD}

Vuggesystemet består af tre dele
\begin{description}
\item[Motorsystem block:] Består af en motor til at drive vuggebevægelsen samt en motorkreds til strømstyringen af motoren. Motorkredsen sørger for at motorens ankerspænding styres vha dutycycle på et PWM-signal og retningen på motoren styres af et logisk signal.
\item[Regulerings MCU block:] Styringsenheden for vuggesystemet. Denne sørger for reguleringen af vuggesystemet samt kommunikationen til og fra controlleren.
\item[Sensor block:] Består af fire sensorer; to Endstop sensorer som måler om barnevognens kurv har nået den mekaniske vuggegrænse, Vuggevinkel sensor måler kurvens absolutte vinkel i forhold til tyngdefelt og Motor positionssensoren måler motorens position.
\end{description}

Følgende beskriver vuggesystemets kobling og grænseflade.

\figur{1}{vuggesystem/sysark/Vuggesystem_IBD.pdf}{IBD for Vuggesystem}{Vug_IBD}

\vspace{5mm} 

\figur{0.5}{vuggesystem/sysark/Endstop_sensor_IBD.pdf}{IBD for Endstop sensorer}{EndstopS_IBD}
\textbf{Endstop sensorer} består af to ens sensorer, hhv. \textbf{Endstop sensor front}, placeret til at detekterer hvis barnevognskurven når den mekaniske vuggegrænse ved fremad vuggeretning, og \textbf{Endstop sensor rear}, placeret til at detekterer hvis barnevognskurven når den mekaniske vuggegrænse ved bagud vuggeretning. Sensorerne giver det samme signal uanset om detekteringen sker i front eller bag.

\vspace{5mm}

\figur{0.5}{vuggesystem/sysark/Vuggevinkel_sensor_IBD.pdf}{IBD for Vuggevinkel sensor}{VugVinkS_IBD}
\textbf{Vuggevinkel sensor} er placeret så den måler barnevognskurvens plan i forhold til jordens tyngdefelt. 

\vspace{5mm}

\figur{0.5}{vuggesystem/sysark/motor_positions_sensor_IBD.pdf}{IBD for Motor positionssensor}{MotoPosS_IBD}
\textbf{Motor positionssensor} giver et frekvenssignal relativ til motorens nuværende hastighed. 

\subsection*{Grænsefladebeskrivelse}
Herunder findes en beskrivelse af grænsefladen til denne del af systemet.

\begin{center}
\begin{longtable}{|p{3cm}|p{2cm}|p{6cm}|}
\caption[Signalbeskrivelse for vuggesystem]{Signalbeskrivelse} 

\label{signalbeskr_vugge} \\

\hline 

\multicolumn{1}{|p{3cm}|}{\textbf{Signal}} & 
\multicolumn{1}{p{2cm}|}{\textbf{Type}} & 
\multicolumn{1}{p{6cm}|}{\textbf{Kommentar}} \\
\hline 
\endfirsthead


\multicolumn{3}{c}%
{{\bfseries \tablename\ \thetable{} --> fortsat fra forrige side}} \\

\multicolumn{1}{|p{3cm}|}{\textbf{Signal}} & 
\multicolumn{1}{p{2cm}|}{\textbf{Type}} & 
\multicolumn{1}{p{6cm}|}{\textbf{Kommentar}} \\
\hline
\endhead


\hline \multicolumn{3}{|r|}{{fortsættes på næste side -->}} \\ \hline
\endfoot

\hline \hline
\endlastfoot

VB & 12V DC & Dette signal kommer direkte fra systemets batteri.\\
\hline
VS & 0V DC & Dette er batteriforsyningens retur\\
\hline
VCC & 3.3V DC & Dette er forsyningen til PSoC og andet logik.\\
\hline
GND & 0V stel & Stelforbindelse til PSoC og andet logik\\
\hline
MotRetning & Digital & HIGH = CW, LOW = CCW\\
\hline
MotSpænding & PWM & PWM som styrer motor spændingen ved VB * \%dc. PWM signalet 0-3.3V CMOS med f = [???]\\
\hline
VuggeV & I2C & Angiver vinklen af vuggen relativt til tyngdefeltet.\\
\hline
MotHast & ?? & Angiver hastigheden af motoren\\
\hline
ESSwitch & Digital & Endstop status, ES-for OR ES-bag, HIGH = ikke ramt LOW = ramt.\\
\hline
I2CVuggesystem & I2C & Styresignal til vuggesystemet\\
\hline
MotForbind & DCMotorSig & Motor tilkobling\\
\hline

\end{longtable}
\end{center}

\subsubsection*{I2C}
I2C er en bus, der består af forbindelserne SDA og SCL. I2C kommunikationen mellem består af 



\newpage
\subsection{Software arkitektur}