\section{Modultest}
Modultest for vuggesystemet beskriver først modultests af hardware modulerne efterfulgt af tests af softwaremodulerne. 
\subsection{Hardware modultest}
Følgende afsnit beskriver tests for de individuelle hardwaremoduler i Vuggesystem-delen af Baby Watch.
\subsubsection{Motorkreds}
\textbf{Formål} \\
Formålet med testen er at måle om motorkredsen kan styre ankerspændingen over en dc motor baseret på et PWM styresignal. Spændingen bør være konsistent også under belastning. Testen udføres ved at et testprogram sender et pwm signal til kredsen hvor værdien af pulsbredden varieres som en 1Hz sinus fra 10\%-90\%. Herefter måles spændingen over motorens terminaler med et oscilloskop over en periode på 5 sekunder. Målingen laves to gange, først hvor motoren er koblet fra systemet, således at der er minimal belastning på motoren. Herefter gentages målingen hvor motoren er koblet til og barnevognen holdes fast, hvormed motoren belastes mest muligt. Da motorkredsen genererer en spænding fra 0V til batterispændingen ved en variation fra 50\% til 100\% pulsbredde og omvvændt fra 50\% til 0\%, bør det målte signal variere med +/- 80\% af batterispændingen (+/- 9,6V). Omend spændingen skal være uafhængig af belastningen, vil den stadig være afhængig af batterispændingen, som vil falde ved stor belastning. Da det forventes at motoren trækker op mod 10A (se figur \vref{vugsys:stroem_maaling}) og batteriets indre modstand er målt til 0.1Ohm, samtidig med at strømmen løber igennem to transistorer med en on modstand på 0,7V hver, kan det forventes at spændingen under hård belastning falder ned til ca. 7,7V (0,8 * (12V - 10A * 0.24hm)). 

\textbf{Overordnet opstilling af Motorkreds test}

\begin{itemize}
	\item Til testen skal Baby Watch Vuggesystemets motor være monteret jf. afsnit \vref{Vuggesystem: Implementering_MV} Mekanik vuggesystem i Implementering for Vuggesystemet
	\item Motorens plus og minus indgange kobles til henholdsvis MOT\_A og MOT\_B jf. afsnit \vref{Vuggesytem:HW_DESIGN_HBRO} i Hardware Design for Vuggesystemet
	\item Et oscilloskop med en differentialprobe kobles på samme sted som motoren
	\item Et PSoC 4 Pioneer Kit \citep{website:Cypress} programmeres med programmet \textit{vuggeSinus} på bilags cd'en \citep{cd} hvilket kan findes under \textit{/SW/Vuggesystem/Testprogrammer/vuggeSinus} og de to PWM output kobles til henholdsvis Mos Driver A indgang M\_A og Mos Driver B indgang M\_B på motorkredsen jf. afsnit \vref{Vuggesytem:HW_DESIGN_MOSDRIVER} i Hardware Design for Vuggesystemet
	\item Under testens første måling tages kæden af motor tanhjulet for at opnå minimal belastning af motoren
\end{itemize} 

\figur{1}{vuggesystem/modultest/MotorKoblingTest.pdf}{kobling af motor ved de to målinger}{vugsys:mtMotorKobling}

\textbf{Testbeskrivelse}
\begin{enumerate}
	\item Opsæt systemet som beskrevet ovenfor
	\item Programmer PSoC4 Pioneer Kittet med VuggeSinus programmet
	\item Tag kæden af motoren som vist på figur \ref{VS:mtMotorKobling} -\textit{Uden belastning}
	\item Start programmet og mål 5 sekunder på oscilloskopet
	\item Luk programmet igen
	\item Sæt kæden på moteren som vist på figur \ref{VS:mtMotorKobling} -\textit{Med belastning}
	\item Start programmet og mål 5 sekunder på oscilloskopet
	\item Luk programmet
	
\end{enumerate}

\textbf{Forventet resultat} \\
Det forventes at det målte output er en sinus med med en frekvens på 1Hz og en amplitude på 9,6V i målingen uden belastning og ned til 7,7V med belastning.

\textbf{Resultat} \\
Herunder ses målingen for testen uden belastning:
\figur{0.75}{vuggesystem/modultest/MotModulFree.pdf}{spændningen over motoren uden belastning}{VS:mtMotorFri}
Det ses her at signalet som forventet varierer fra 9,6V til -9,6V, og man kan konkludere at kredsen fungerer efter hensigten uden belastning.\\
\\
Her ses målingen for testen med belastning:
\figur{0.75}{vuggesystem/modultest/MotModulLoad.pdf}{spændningen over motoren med belastning}{VS:mtMotorLast}
Denne måling viser som forventet en lidt lavere spænding. At signalet her ikke længere er en ren sinus, skyldes at belastningen af motoren ikke er jævn ved alle vinkler. Da spændingen her ikke falder under den forventede værdi (første positive peak er mellem 7,5V og 8V), kan denne del af testen ligeledes godkendes.

\textit{Testen er godkendt}

\subsubsection{Endstopsensor}
\textbf{Formål} \\
Formålet med testen er at se om Vuggesystemet melder om fejl ved aktivering af en af Endstopsensorerne. Beskrivelse af Endstopsensor kan ses i afsnit \vref{Vuggesystem: Design_ES}.

\textbf{Overordnet opstilling af Enstopsensor test}

\begin{itemize}
	\item Testen foregår i et rum med et horisontalt nivelleret gulv
	\item Til testen skal bruges: En Windows 8.1 computer \citep{website:Windows_8_1} med USB porte og et terminal program installeret 
	\item Et PSoC4 Pioneer Kit \citep{website:Cypress}
	\item Baby Watch barnevognen monteres med Endstopsensorne jf.\vref{Vuggesystem: Implementering_ES} i Implementeringen for Vuggesystemet 
	\item Baby Watch barnevogns kurven sættes i et vandret niveau
	\item PSoC4 Pioneer Kittet er tilsluttet computeren
	\item Computeren har startet terminal programmet som har oprettet forbindelse til den givne com port PSoC4 Pioneer Kittet sidder på
	\item PSoC4 Pioneer Kittet programmeres med \textit{VuggeControl} programmet på \citep{cd} under 
	\textit{/SW/Vuggesystem/vuggeControl}   
\end{itemize}

\textbf{Testbeskrivelse}
\begin{itemize}
	\item Opsæt systemet som beskrevet ovenfor
	\item Baby Watch barnevognskurven sættes ud i en yder position så en Endstopsensor aktives
	\item I terminal programmet på computeren vises "ENDSTOP AKTIVERET"
	\item Testen gentages men denne gang med aktivering af den anden Endstop Sensor i den modsatte yder position
\end{itemize}

\textbf{Forventet resultat} \\
Det forventes at der ved aktivering ved begge yder positioner skrive "ENDSTOP AKTIVERET" i terminal vinduet på computeren \\
\textbf{Resultat} \\
Resultatet blev som forventet. Nedenståede blev udskrevet ved aktivering af begge Endstopsensorer.\\

\figur{0.25}{vuggesystem/modultest/ENDSTOP_AKTIVERET.pdf}{Udskrift af terminal vindue om endstop aktivering}{vuggesystem:ModulT_Endstop}

\textit{Testen er godkendt}



\subsubsection{Mekanisk vuggesystem}
\textbf{Formål} \\
Formålet med denne modultest er at observere om det mekaniske vuggesystem er i stand til at "vippe" en barnevognskurv over en horisontal akse jf. afsnit \vref{kravspec:ikke_funk_nivellering} i Ikke-funktionelle krav fra den ene yder position til den anden tre gange i sekvens. 

\textbf{Overordnet opstilling af Mekanisk vuggesystem test}

\begin{itemize}
	\item Testen forgår i et rum med et horisontal nivelleret gulv
	\item Baby Watch Vuggesystemet er monteret jf. afsnit \ref{Vuggesystem: Implementering} Implementering for Vuggesystemet
	\item Motorens plus og minus indgange kobles til henholdsvis MOT\_A og MOT\_B jf. afsnit \ref{Vuggesytem:HW_DESIGN_HBRO} i Hardware Design for Vuggesystemet
	\item En tonegenerator af typen Analog Discovery \citep{analogD} er koblet til Mos Driver A indgang M\_A og Mos Driver B indgang M\_B på motorkredsen jf. afsnit \vref{Vuggesytem:HW_DESIGN_MOSDRIVER} i Hardware Design for Vuggesystemet
	\item Tonegeneratoren generer et PWM signal på 20kHz med en duty cycle på 50\% positiv
	\item Barnevognskurven sættes i hovedende yderpositionen
\end{itemize}


\textbf{Testbeskrivelse}
\begin{itemize}
	\item Opsæt systemet som beskrevet ovenfor
	\item Duty cycle øges 90\% positiv
	\item Barnevognskurven skifter til fodende yderpositionen
	\item Duty cycle reduceres til 10\% positiv
	\item Barnevognskurven skifter til hovedende yderpositionen
	\item Punkt 2 til 5 gentages yderligere 2 gange
\end{itemize}

\textbf{Forventet resultat} \\
Det forventes at det mekaniske vuggesystem er i stand til at "vippe" barnevognen som beskrevet i Formålet tre gange i sekvens fra yderposition til yderposition.

\textbf{Resultat} \\
Resultatet blev som forventet. Det mekaniske vuggesystem "vippede" barnevognskurven fra yderposition til yderposition tre gange i sekvens.

\textit{Testen er godkendt}


\subsection{Software modultest}
Dette afsnit beskriver tests for de individuelle hardwaremoduler i Vuggesystem delen af Baby Watch.
\subsubsection{Vuggeudsvingssensor}
\textbf{Formål} \\
Formålet er at teste om Vuggeudsvingssensor monteret på en barnevognskurv der "vipper" over en horisontal akse jf. afsnit \vref{kravspec:ikke_funk_nivellering} i Ikke-funktionelle krav er i stand til at detektere vinklen i forhold til tyngdefeltet. For at testen kan godkendes forventes en præcision på mindst +/- 2 grader.

Testen dokumenteres med en sammenligning af den målte vinkel fra Vuggeudsvingssensor relativ til den målte vinkel af et elektronisk vaterpas. Vinklen måles fra den mekaniske yderposition til den anden mekaniske yderposition i 5 graders intervaller.

\textbf{Overordnet opstilling af Vuggeudsvingssensor test}

\begin{itemize}
	\item Testen foregår i et rum med et horisontalt nivelleret gulv
	\item Til testen skal bruges Baby Watch barnevognen monteret med Vuggeudsvingssensor jf.\vref{Vuggesystem: Implementering_VuggeudsvingSensor} i Implementeringen for Vuggesystemet
	\item Et PSoC 4 Pioneer Kit af typen CY8CKIT-042 
	\item En mobiltelefon af typen Samsung Galaxy S4 mini \citep{website:Samsung} med vaterpas-programmet Clinometer \citep{website:Clinometer} og streamming programmet Mobizen \citep{website:Mobizen}
	\item En Windows 8.1 \citep{website:Windows_8_1} computer med et terminalprogram, med USB-porte og Microsoft Excel\citep{website:Excel} installeret 
	\item Programmene Clinometer og Mobizen startes på mobiltelefonen og Mobizen startes ligeledes på computeren
	\item PSoC4 Kittet tilsluttes en computer via USB
	\item Terminalprogrammet startes på computeren og indstilles til PSoC4 kittes USB Com-port
	\item Baby Watch barnevogns kurven sættes i en mekanisk yderposition
	\item PSoC4 Pioneer Kittet er tilsluttet en computer
	\item PSoC4 Pioneer Kittet programmeres med programmet \textit{vinkelsensor test} på bilags cd'en \citep{cd} hvilket kan findes under \textit{/SW/Vuggesystem/vinkelsensor test}
\end{itemize}

\textbf{Testbeskrivelse}
\begin{itemize}
\item Opsæt systemet som beskrevet ovenfor
\item Baby Watch barnevognskurven vippes med håndkraft fra yderposition til yderposition i intervallet -24.7, -20, -15, -10, -5, 0, 5, 10, 15, 20, 24.5 grader\footnotemark målt med det elektriske vaterpas 
\item På terminalprogrammet på computeren udskrives data som angiver vinklen i fix16.16 format ved hvert af intervallerne
\item Disse data ligges ind i Microsoft Excel og sammenlignes
\end{itemize}

\textbf{Forventet resultat} \\
Det forventes at de målte data fra Vinkeludvingssensor passer overens med det elektroniske vaterpas med max +/- 2 grader difference.
 \\

\footnotetext{Der forventes en kontinuert kurve der begynder i 0 graders vinkel som efterfølgende skifter karakter til en trekantkurve der går fra -24.7 grader til 24.8 grader vinkel og til sidst stopper på 0 grader vinkel igen.}

\textbf{Resultat} \\
Resultatet er som forventet:
\figur{0.8}{vuggesystem/modultest/vugUdsving_modulData.pdf}{Samlings tabel af målte Vuggeudsving Sensor vinkeler og elektronsk vaterpas værdier}{vuggesystem:ModulT_VugUdSens}

\textit{Testen er godkendt}

\subsubsection{Vuggesystemet}
\textbf{Formål} \\
Formålet er at teste hele vuggesystemet som reguleringsmodul for Baby Watch systemet. Testen udføres i seks udgaver alle med en 10 kg mervægt i barnevognskurven. Testen dokumenteres med video.

\textit{Testudgaver}*
\begin{itemize}
	\item Vuggesystemet regulerer barnevognskurven i en 0 graders vinkel-amplitude med en vippe-frekvens på 0 Hz
	\item Vuggesystemet regulerer barnevognskurven i sekvens af først 10 graders vinkel-amplitude med en vippe-frekvens på 0.5 Hz efterfulgt af 6 graders vinkel-amplitude med en vippe-frekvens på 1 Hz og til sidst af 4 graders vinkel-amplitude med en vippe-frekvens på 2 Hz
	\item Vuggesystemet regulerer barnevognskurven i sekvens af først 6 graders vinkel-amplitude med en vippe-frekvens på 1 Hz efterfulgt af 10 graders vinkel-amplitude med en vippe-frekvens på 0.5 Hz og til sidst af 4 graders vinkel-amplitude med en vippe-frekvens på 2 Hz
	\item Vuggesystemet regulerer barnevognskurven i 8 graders vinkel amplitude med en vippe frekvens på 0.75 Hz
	\item Barnevognskurven presses ned i en yderpositon så en endstop sensor aktives
	\item Barnevognskurven presses ned i modsatte yderpositon så den anden endstop sensor aktives
\end{itemize}
*Alle vinkler er i forhold til tyngdefeltet.


\textbf{Overordnet opstilling af Vuggesystem modultest}

\begin{itemize}
	\item Testen foregår i et rum med et horisontalt nivelleret gulv
	\item Vuggesystemet er opsat jf. implementeringen af Vuggesystem afsnit \vref{Vuggesystem: Implementering}
	\item En mobiltelefon af typen Samsung Galaxy S4 Mini \citep{website:Samsung} er opsat og klar til optagelse
\end{itemize}
// Figur med billede af testopstillingen

\textbf{Testbeskrivelse}
\begin{itemize}
	\item Testen opsættes om beskrevet ovenfor
	\item Hvert punkt i \textit{Testudgaver} under Formål udføres og dokumenteres med video
\end{itemize}

\textbf{Forventet resultat} \\
Der forventes at:
\begin{itemize}
	\item Barnevognskurven holdes i en vandret på position i forhold til tyngdefeltet
	\item Barnevognskurven vugges i en sekvens af først 10 graders vinkel-amplitude med en vippe-frekvens på 0.5 Hz efterfulgt af 6 graders vinkel-amplitude med en vippe-frekvens på 1 Hz og til sidst af 4 graders vinkel-amplitude med en vippe-frekvens på 2 Hz
	\item Barnevognskurven vugges i en sekvens af først 6 graders vinkel-amplitude med en vippe-frekvens på 1 Hz efterfulgt af 10 graders vinkel-amplitude med en vippe-frekvens på 0.5 Hz og til sidst af 4 graders vinkel-amplitude med en vippe-frekvens på 2 Hz
	\item Barnevognskurven vugges i en 8 graders vinkel amplitude med en vippe frekvens på 0.75 Hz
	\item Når barnevognskurven presses ned i en yderpositon aktives en endstop sensor og vuggesystemet stopper med alt vugning 
	\item Når barnevognskurven presses ned i den modsatte yderpositon aktives en endstop sensor og vuggesystemet stopper med alt vugning 
\end{itemize}
*Alle vinkler er i forhold til tyngdefeltet.

\textbf{Resultat} \\
// Resultatet beskrives og der henvis til optagelserne \\


\textit{Testen er godkendt/ikke-godkendt}